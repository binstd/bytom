{"data":{"markdownRemark":{"html":"<p>在上上篇文章里，我们还剩下一个小问题没有解决，即前端是如何显示一个交易的详细信息的。</p>\n<p>先看对应的图片：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bytom-transaction-detail1-63c11e60a5e582dd408d2a2bdea3424c-8f54b.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 107.85388127853881%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAACNElEQVQ4y5VViXKFIAz0//+0fR4gIKJAmg3GasfXaZ3ZcjxYks3Rzu2JxrjQ8BrIhUDeM0KD4/meM9Va36Jc5vyHur7vaRxHcs6RtVYwzzPNvJ51D2uGY1g7yxpj23OyP1pDH9NI3TQZ6l89pZRo2zaB814eMfyb7KWNlmUhEzwlXuvZNa40eH6YPcSe47Fb15XiEinnQvqta6KZLfDOn3tw3bM816+UQnNaaS353GMLJ+r7gbXzol9g7WZ2A/vGGFkH0daTZWt0DTh+0MDt4y7OdANcM5ZijO2iHHRyGAdBrrrJ/NAPBJBBEBa+u8j9DkT4ECXM4frCEgQGxsiSpLQ1bN8opbZ7VwkQZbCCLLNGE1u777uki50RZS9zkC4cgBgxRplrOoEYaByFCdlkLEBkxkmIEZSVo4Yxs/DlES0HS/1BCA3U7MDWgBDubdveElbkaK7dUO/QqHcIAFIHADl01ErR/f+g+/x8SRJ7iWirEDyCtTvm/0Fz+ahFuAwtRTt2/TfAvfqkIfIHGoAIyYzoabrcEO94ahoIoFgopcWElhMcL+/7xYIjqrXWW9k9dp4roeYiPuTgMJqW1FtLajx4JXr6TsLT5EMbaCjJu+dfLXproW6gu0AbaORZW4hcL6L/iTAcib2za61SihQ+rHy+VM8q+dm180l4RBkNNV+iDNLrqBr/KShKCJe1OWiD0FFLcpNuU964zCUGk9HO8f9BNVzivcPEW7eJYgAI8gFJN777BZ4xukGhf0RjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"bytom-transaction-detail1\"\n        title=\"\"\n        src=\"/static/bytom-transaction-detail1-63c11e60a5e582dd408d2a2bdea3424c-acf85.png\"\n        srcset=\"/static/bytom-transaction-detail1-63c11e60a5e582dd408d2a2bdea3424c-c1418.png 210w,\n/static/bytom-transaction-detail1-63c11e60a5e582dd408d2a2bdea3424c-5d5d8.png 420w,\n/static/bytom-transaction-detail1-63c11e60a5e582dd408d2a2bdea3424c-acf85.png 840w,\n/static/bytom-transaction-detail1-63c11e60a5e582dd408d2a2bdea3424c-8f54b.png 1095w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    \n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bytom-transaction-detail2-9eac917a8af478519aa2b8bc6ab81d19-a62e3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 840px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 114.40520446096653%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAB3klEQVQ4y5VV2XKDMAzk/380fWmb4PtC1crYAWJI6pkdgoG1pNUq0+32RdZagda6/3bOXaK9t4UxhqacM2GllMg7TzEm0sZSCIF8iIzAv/nqQwXuY6RlWXaoHJkmfIiV+QaEORd5gAOe1yMylVKoMJGgVFI8m3A6luVwjTYUedNapOVPgUhBuAwJYyVUsxJCRNhfLuUUx5Q7YVwJI6eODbz8e3+QQrTxWUPsH9dLDVmPTtgWNkFmOG1EO4pkhCZsJ8SNZXUzR2K5LWqdlo8JX1KGKCCEgi3dqxRPCVvbzA+um1KiMtJFP6J2glixU3aLMojQey/djhoadD2TosE1RwtYbpePagi7VDLXraf4qo3pZFpEsvLeOztKyjgBkWITqUIQWPKI7hS5LzugHODoKeMDWA8fNDc4v3GIr0Dqfg3iUmVJR3ov9yFwRAjnw2Gg8kxaaWkbKL1LkRE3aI6CuhXlNUK3Fh0PIVC127Lz7lVP9vGFE7cLkX3/3OnBwwKkODDGsZePK2+9LAPWe9lsRO3kf1mvja8ABcV6SaKDop+SlWUwYGceWRAlptqHSUTZ492w2ImC4dpUhuXgDLGe4L31AKmhuCMl6TG3ji1jrChtVmIj/4K+CzQColMc0B8QTRJTE2XcIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"bytom-transaction-detail2\"\n        title=\"\"\n        src=\"/static/bytom-transaction-detail2-9eac917a8af478519aa2b8bc6ab81d19-acf85.png\"\n        srcset=\"/static/bytom-transaction-detail2-9eac917a8af478519aa2b8bc6ab81d19-c1418.png 210w,\n/static/bytom-transaction-detail2-9eac917a8af478519aa2b8bc6ab81d19-5d5d8.png 420w,\n/static/bytom-transaction-detail2-9eac917a8af478519aa2b8bc6ab81d19-acf85.png 840w,\n/static/bytom-transaction-detail2-9eac917a8af478519aa2b8bc6ab81d19-a62e3.png 1076w\"\n        sizes=\"(max-width: 840px) 100vw, 840px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>这个图片由于太长，分成了两个，实际上可以看作一个。</p>\n<p>那么这个页面是怎么来的呢？这是在前面以列表的方式显示交易摘要信息后，可以点击摘要信息右上角的“查看详情”链接打开。</p>\n<p>那我们在本文看一下，比原是如何显示这个交易的详细信息的。</p>\n<p>由于它分成了前后两端，那么我们跟以前一样，把它再分成两个小问题：</p>\n<ol>\n<li>前端是怎么向后台发送请求，并显示数据的</li>\n<li>后端是如何拿到相应的数据发送给前台的</li>\n</ol>\n<p>需要说明的是，这个表格中包含了很多信息，但是我们在本文并不打算去解释。因为能看懂的一看就能明白，看不懂的就需要准确的了解了比原的核心之后才能解释清楚，而这一块等到我们晚点再专门研究。</p>\n<h2 id=\"前端是怎么向后台发送请求，并显示数据的\"><a href=\"#%E5%89%8D%E7%AB%AF%E6%98%AF%E6%80%8E%E4%B9%88%E5%90%91%E5%90%8E%E5%8F%B0%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%B9%B6%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E7%9A%84\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前端是怎么向后台发送请求，并显示数据的</h2>\n<p>首先我们看一下显示交易详细信息页面的路由path是多少。当我们把鼠标放在交易摘要页面右上角的“查看详情”时，会发现url类似于：</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-text\"><code class=\"gatsby-code-text\">http://localhost:9888/dashboard/transactions/2d94709749dc59f69cad4d6aea666586d9f7e86b96c9ee81d06f66d4afb5d6dd</code></pre>\n      </div>\n<p>其中<code class=\"gatsby-code-text\">http://localhost:9888/dashboard/</code>可以看作是这个应用的根路径，那么路由path应该就是<code class=\"gatsby-code-text\">/transactions/2d94709749dc59f69cad4d6aea666586d9f7e86b96c9ee81d06f66d4afb5d6dd</code>，后面那么长的显然是一个id，所以我们应该到代码中寻找类似于<code class=\"gatsby-code-text\">/transactions/:id</code>这样的字符串，哦，遗憾的是没有找到。。。</p>\n<p>那只能从头开始了，先找到前端路由的定义：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/routes.js#L15-L35\">src/routes.js#L15-L35</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> routes <span class=\"token keyword\">as</span> transactions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'features/transactions'</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeRoutes</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n  component<span class=\"token punctuation\">:</span> Container<span class=\"token punctuation\">,</span>\n  childRoutes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token function\">transactions</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>其中的<code class=\"gatsby-code-text\">transactions</code>就是我们需要的，而它对应了<code class=\"gatsby-code-text\">features/transactions/routes.js</code>：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/transactions/routes.js#L1-L21\">src/features/transactions/routes.js#L1-L21</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> List<span class=\"token punctuation\">,</span> New<span class=\"token punctuation\">,</span> AssetShow<span class=\"token punctuation\">,</span> AssetUpdate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./components'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> makeRoutes <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'features/shared'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">makeRoutes</span><span class=\"token punctuation\">(</span>\n    store<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'transaction'</span><span class=\"token punctuation\">,</span>\n    List<span class=\"token punctuation\">,</span>\n    New<span class=\"token punctuation\">,</span>\n    Show<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>这个函数将会为<code class=\"gatsby-code-text\">transactions</code>生成很多相关的路由路径。当我们把一些组件，比如列表显示<code class=\"gatsby-code-text\">List</code>，新建<code class=\"gatsby-code-text\">New</code>，显示详情<code class=\"gatsby-code-text\">Show</code>等等传进去之后，<code class=\"gatsby-code-text\">makeRoutes</code>就会按照预先定义好的路径规则去添加相关的path。我们看一下<code class=\"gatsby-code-text\">makeRoutes</code>：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/shared/routes.js#L1-L44\">src/features/shared/routes.js#L1-L44</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RoutingContainer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'features/shared/components'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> humanize <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'utility/string'</span>\n<span class=\"token keyword\">import</span> actions <span class=\"token keyword\">from</span> <span class=\"token string\">'actions'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeRoutes</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> List<span class=\"token punctuation\">,</span> New<span class=\"token punctuation\">,</span> Show<span class=\"token punctuation\">,</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">loadPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>actions<span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> childRoutes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>New<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    childRoutes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span>\n      component<span class=\"token punctuation\">:</span> New\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>childRoutes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    childRoutes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>options<span class=\"token punctuation\">.</span>childRoutes<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 1. </span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Show<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    childRoutes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token punctuation\">:</span> <span class=\"token string\">':id'</span><span class=\"token punctuation\">,</span>\n      component<span class=\"token punctuation\">:</span> Show\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 2.    </span>\n    path<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">.</span>path <span class=\"token operator\">||</span> type <span class=\"token operator\">+</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> RoutingContainer<span class=\"token punctuation\">,</span>\n    name<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">.</span>name <span class=\"token operator\">||</span> <span class=\"token function\">humanize</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">+</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    name_zh<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">.</span>name_zh<span class=\"token punctuation\">,</span>\n    indexRoute<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      component<span class=\"token punctuation\">:</span> List<span class=\"token punctuation\">,</span>\n      onEnter<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">loadPage</span><span class=\"token punctuation\">(</span>nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      onChange<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token function\">loadPage</span><span class=\"token punctuation\">(</span>nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    childRoutes<span class=\"token punctuation\">:</span> childRoutes\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>这段代码看起来眼熟，因为我们在之前研究余额和交易的列表显示的时候，都见过它。而我们今天关注的是<code class=\"gatsby-code-text\">Show</code>，即标记为第1处的代码。</p>\n<p>可以看到，当传进来了<code class=\"gatsby-code-text\">Show</code>组件时，就需要为其生成相关的路由path。具体是在<code class=\"gatsby-code-text\">childRouters</code>中添加一个<code class=\"gatsby-code-text\">path</code>为<code class=\"gatsby-code-text\">:id</code>，而它本身的路由path是在第2处定义的，默认为<code class=\"gatsby-code-text\">type + &#39;s&#39;</code>，而对于本例来说，<code class=\"gatsby-code-text\">type</code>的值就是<code class=\"gatsby-code-text\">transaction</code>，所以<code class=\"gatsby-code-text\">Show</code>所对应的完整path就是<code class=\"gatsby-code-text\">/transactions/:id</code>，正是我们所需要的。</p>\n<p>再回到第1处代码，可以看到<code class=\"gatsby-code-text\">Show</code>组件是从外部传进来的，从前面的函数可以看到它对应的是<code class=\"gatsby-code-text\">src/features/transactions/components/Show.jsx</code>。</p>\n<p>我们进去看一下这个<code class=\"gatsby-code-text\">Show.jsx</code>，首先是定义html组件的函数<code class=\"gatsby-code-text\">render</code>：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/transactions/components/Show.jsx#L16-L96\">src/features/transactions/components/Show.jsx#L16-L96</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Show</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">BaseShow</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1.</span>\n    <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>item\n    <span class=\"token keyword\">const</span> lang <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>lang\n    <span class=\"token keyword\">const</span> btmAmountUnit <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>btmAmountUnit\n\n    <span class=\"token keyword\">let</span> view\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ..</span>\n      view <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PageTitle</span> <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PageContent</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">// ...</span>\n\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>KeyValueTable</span>\n            <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>lang <span class=\"token operator\">===</span> <span class=\"token string\">'zh'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'详情'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'Details'</span><span class=\"token punctuation\">}</span></span>\n            <span class=\"token attr-name\">items</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>\n              <span class=\"token comment\">// ...</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token punctuation\">/></span></span>\n\n          <span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>inputs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n            <span class=\"token operator\">&lt;</span>KeyValueTable\n              <span class=\"token comment\">// ...</span>\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\n          <span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>outputs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n            <span class=\"token operator\">&lt;</span>KeyValueTable\n              <span class=\"token comment\">// ...</span>\n            <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PageContent</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">renderIfFound</span><span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>代码被我进行了大量的简化，主要是省略了很多数据的计算和一些显示组件的参数。我把代码分成了2部分：</p>\n<ol>\n<li>第1处需要注意的是类似于<code class=\"gatsby-code-text\">const item = this.props.item</code>这样的代码，这里的<code class=\"gatsby-code-text\">item</code>就是我们要展示的数据，对应本文就是一个<code class=\"gatsby-code-text\">transaction</code>对象，它是从<code class=\"gatsby-code-text\">this.props</code>中拿到的，所以我们可以推断在这个文件（或者引用的某个文件）中，会有一个<code class=\"gatsby-code-text\">connect</code>方法，把store里的数据塞过来。一会儿我们去看看。后面两行类似就不说了。</li>\n<li>第2处代码主要就是页面view的定义了，可以看到里面主要是用到了另一个自定义组件<code class=\"gatsby-code-text\">KeyValueTable</code>。代码我们就不跟过去了，参照前面的页面效果我们可以想像出来它就是以表格的形式把一些key-value数据显示出来。</li>\n</ol>\n<p>那我们继续去寻找<code class=\"gatsby-code-text\">connect</code>，很快就在同一个页面的后面，找到了如下的定义：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/transactions/components/Show.jsx#L100-L117\">src/features/transactions/components/Show.jsx#L100-L117</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> actions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'features/transactions'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> connect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">mapStateToProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> ownProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  item<span class=\"token punctuation\">:</span> state<span class=\"token punctuation\">.</span>transaction<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">[</span>ownProps<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  lang<span class=\"token punctuation\">:</span> state<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">,</span>\n  btmAmountUnit<span class=\"token punctuation\">:</span> state<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>btmAmountUnit<span class=\"token punctuation\">,</span>\n  highestBlock<span class=\"token punctuation\">:</span> state<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>coreData <span class=\"token operator\">&amp;&amp;</span> state<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>coreData<span class=\"token punctuation\">.</span>highestBlock\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>\n  mapStateToProps<span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>Show<span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>我只留下了需要关注的<code class=\"gatsby-code-text\">mapStateToProps</code>。可以看到，我们在前面第1处中看到的几个变量的赋值，在这里都有定义，其中最重要的<code class=\"gatsby-code-text\">item</code>，是从store的当前状态<code class=\"gatsby-code-text\">state</code>中的<code class=\"gatsby-code-text\">transaction</code>中的<code class=\"gatsby-code-text\">items</code>中取出来的。</p>\n<p>那么<code class=\"gatsby-code-text\">state.transaction</code>是什么呢？我开始以为它是我们从后台取回来的一些数据，使用<code class=\"gatsby-code-text\">transaction</code>这个名字放到了store里，结果怎么都搜不到，最后终于发现原来不是的。</p>\n<p>实际情况是，在我们定义reducer的地方，有一个<code class=\"gatsby-code-text\">makeRootReducer</code>：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/reducers.js#L1-L62\">src/reducers.js#L1-L62</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> reducers <span class=\"token keyword\">as</span> transaction <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'features/transactions'</span>\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeRootReducer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    transaction<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>原来它是在这里构建出来的。首先<code class=\"gatsby-code-text\">{ transaction }</code>这种ES6的语法，换成平常的写法，就是：</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token punctuation\">{</span>\n  transaction<span class=\"token punctuation\">:</span> transaction\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>另外，<code class=\"gatsby-code-text\">combineReducers</code>这个方法，是用来把多个reducer合并起来（可能是因为store太大，所以把它拆分成多个reducer管理，每个reducer只需要处理自己感兴趣的部分），并且合并以后，这个store就会变成大概这样：</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"transaction\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>所以前面的<code class=\"gatsby-code-text\">state.transaction</code>就是指的这里的<code class=\"gatsby-code-text\">{ ... }</code>。</p>\n<p>那么继续，在前面的代码中，可以从<code class=\"gatsby-code-text\">state.transaction.items[ownProps.params.id]</code>看到，<code class=\"gatsby-code-text\">state.transaction</code>还有一个<code class=\"gatsby-code-text\">items</code>的属性，它持有的是向后台<code class=\"gatsby-code-text\">/list-transactions</code>取回的一个transaction数组，它又是什么时候加上去的呢？</p>\n<p>这个问题难倒了我，我花了几个小时搜遍了比原的前后端仓库，都没找到，最后只好使出了Chrome的Redux DevTools大法，发现在一开始的时候，<code class=\"gatsby-code-text\">items</code>就存在了：</p>\n<p><img src=\"./images/redux-devtools-transaction-items.png\" alt=\"redux-devtools-transaction-items\"></p>\n<p>在图上有两个红框，左边的表示我现在选择的是初始状态，右边显示最开始<code class=\"gatsby-code-text\">transaction</code>就已经有了<code class=\"gatsby-code-text\">items</code>，于是恍然大悟，这不跟前面是一样的道理嘛！于是很快找到了定义：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/transactions/reducers.js#L7-L16\">src/features/transactions/reducers.js#L7-L16</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  items<span class=\"token punctuation\">:</span> reducers<span class=\"token punctuation\">.</span><span class=\"token function\">itemsReducer</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  queries<span class=\"token punctuation\">:</span> reducers<span class=\"token punctuation\">.</span><span class=\"token function\">queriesReducer</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  generated<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token string\">'GENERATED_TX_HEX'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>action<span class=\"token punctuation\">.</span>generated<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>state<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> maxGeneratedHistory<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> state\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>果然，这里也是用<code class=\"gatsby-code-text\">combineReducers</code>把几个reducer组合在了一起，所以store里就会有这里的几个key，包括<code class=\"gatsby-code-text\">items</code>，以及我们不关心的<code class=\"gatsby-code-text\">queries</code>和<code class=\"gatsby-code-text\">generated</code>。</p>\n<p>花了一下午，终于把这块弄清楚了。看来对于分析动态语言，一定要脑洞大开，不能预设原因，另外要利用各种调试工具，从不同的角度去查看数据。要不是Redux的Chrome插件，我不知道还要卡多久。</p>\n<p>我个人更喜欢静态类型的语言，对于JavaScript这种，除非万不得以，能躲就躲，主要原因就是代码中互相引用的线索太少了，很多时候必须看文档、代码甚至去猜，无法利用编辑器提供的跳转功能。</p>\n<p>知道了<code class=\"gatsby-code-text\">state.transaction.items</code>的来历以后，后面的事情就好说了。我们是从<code class=\"gatsby-code-text\">state.transaction.items[ownProps.params.id]</code>拿到了当前需要的transaction，那么<code class=\"gatsby-code-text\">state.transaction.items</code>里又是什么时候放进去数据的呢？</p>\n<p>让我们再回到前面的<code class=\"gatsby-code-text\">makeRoutes</code>：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/shared/routes.js#L1-L44\">src/features/shared/routes.js#L1-L44</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> actions <span class=\"token keyword\">from</span> <span class=\"token string\">'actions'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeRoutes</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> List<span class=\"token punctuation\">,</span> New<span class=\"token punctuation\">,</span> Show<span class=\"token punctuation\">,</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 2.</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">loadPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    store<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>actions<span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">fetchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">.</span>path <span class=\"token operator\">||</span> type <span class=\"token operator\">+</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> RoutingContainer<span class=\"token punctuation\">,</span>\n    name<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">.</span>name <span class=\"token operator\">||</span> <span class=\"token function\">humanize</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">+</span> <span class=\"token string\">'s'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    name_zh<span class=\"token punctuation\">:</span> options<span class=\"token punctuation\">.</span>name_zh<span class=\"token punctuation\">,</span>\n    indexRoute<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      component<span class=\"token punctuation\">:</span> List<span class=\"token punctuation\">,</span>\n      onEnter<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">loadPage</span><span class=\"token punctuation\">(</span>nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 1. </span>\n      onChange<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token function\">loadPage</span><span class=\"token punctuation\">(</span>nextState<span class=\"token punctuation\">,</span> replace<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    childRoutes<span class=\"token punctuation\">:</span> childRoutes\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>在上面的第1处，对于<code class=\"gatsby-code-text\">indexRoute</code>，有一个<code class=\"gatsby-code-text\">onChange</code>的触发器。它的意思是，当路由的path改变了，并且新的path属于当前的这个index路由的path（或者子path），后面的函数将会触发。而后面函数中的<code class=\"gatsby-code-text\">loadPage</code>的定义在第2处代码，它又会将<code class=\"gatsby-code-text\">actions[type].fetchAll()</code>生成的action进行dispatch。由于<code class=\"gatsby-code-text\">type</code>在本文中是<code class=\"gatsby-code-text\">transaction</code>，通过一步步追踪（这里稍有点麻烦，不过我们在之前的文章中已经走过），我们发现<code class=\"gatsby-code-text\">actions[type].fetchAll</code>对应了<code class=\"gatsby-code-text\">src/features/shared/actions/list.js</code>：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/shared/actions/list.js#L4-L147\">src/features/shared/actions/list.js#L4-L147</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> listPath  <span class=\"token operator\">=</span> options<span class=\"token punctuation\">.</span>listPath <span class=\"token operator\">||</span> <span class=\"token template-string\"><span class=\"token string\">`/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">s`</span></span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">clientApi</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> options<span class=\"token punctuation\">.</span>clientApi <span class=\"token operator\">?</span> options<span class=\"token punctuation\">.</span><span class=\"token function\">clientApi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">chainClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">s`</span></span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchAll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...</span>\n    fetchAll<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>如果我们还对这一段代码有印象的话，就会知道它最后将会去访问后台的<code class=\"gatsby-code-text\">/list-transactions</code>，并在拿到数据后调用<code class=\"gatsby-code-text\">dispatch(&quot;RECEIVED_TRANSACTION_ITEMS&quot;)</code>，而它将会被下面的这个reducer处理：</p>\n<p><a href=\"https://github.com/freewind/bytom-dashboard-v1.0.0/blob/master/src/features/shared/reducers.js#L6-L28\">src/features/shared/reducers.js#L6-L28</a></p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsx\"><code class=\"gatsby-code-jsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">itemsReducer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">,</span> idFunc <span class=\"token operator\">=</span> defaultIdFunc<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type <span class=\"token operator\">==</span> <span class=\"token template-string\"><span class=\"token string\">`RECEIVED_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_ITEMS`</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1.</span>\n    <span class=\"token keyword\">const</span> newObjects <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 2.</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> type<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token string\">'TRANSACTION'</span> <span class=\"token operator\">?</span> action<span class=\"token punctuation\">.</span>param<span class=\"token punctuation\">.</span>data <span class=\"token punctuation\">:</span> action<span class=\"token punctuation\">.</span>param<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>data<span class=\"token punctuation\">,</span>\n      id<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">.</span>txId<span class=\"token punctuation\">,</span>\n      timestamp<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">.</span>blockTime<span class=\"token punctuation\">,</span>\n      blockId<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">.</span>blockHash<span class=\"token punctuation\">,</span>\n      position<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">.</span>blockIndex\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. </span>\n    <span class=\"token punctuation\">(</span>data <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>item <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token function\">idFunc</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n      newObjects<span class=\"token punctuation\">[</span><span class=\"token function\">idFunc</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> item\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> newObjects\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// ...</span>\n\n  <span class=\"token keyword\">return</span> state\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>依次讲解这个函数中的三处代码：</p>\n<ol>\n<li>第1处是创建了一个新的空对象<code class=\"gatsby-code-text\">newObjects</code>，它将在最后替代<code class=\"gatsby-code-text\">state.transaction.items</code>，后面会向它里面赋值</li>\n<li>第2处是对传进来的数据进行一些处理，如果type是<code class=\"gatsby-code-text\">transaction</code>的话，会把数组中每个元素中的某些属性提升到根下，方便使用</li>\n<li>第3处就是把各个元素放到<code class=\"gatsby-code-text\">newObjects</code>中，<code class=\"gatsby-code-text\">id</code>为key，对象本身为value</li>\n</ol>\n<p>经过这些处理以后，我们才能使用<code class=\"gatsby-code-text\">state.transaction.items[ownProps.params.id]</code>拿到合适的transaction对象，并且由<code class=\"gatsby-code-text\">Show.jsx</code>显示。</p>\n<p>前端这块基本上弄清楚了。我们继续看后端</p>\n<h2 id=\"后端是如何拿到相应的数据发送给前台的\"><a href=\"#%E5%90%8E%E7%AB%AF%E6%98%AF%E5%A6%82%E4%BD%95%E6%8B%BF%E5%88%B0%E7%9B%B8%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81%E7%BB%99%E5%89%8D%E5%8F%B0%E7%9A%84\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>后端是如何拿到相应的数据发送给前台的</h2>\n<p>前面我们说过，根据以往的经验，我们可以推导出前端会访问后端的<code class=\"gatsby-code-text\">/list-transactions</code>这个接口。我们欣喜的发现，这个接口我们正好在前一篇文章中研究过，这里就可以完全跳过了。</p>\n<p>到今天为止，我们终于把“比原是如何创建一个交易的”这件事的基本流程弄清楚了。虽然还有很多细节，以及触及到核心的知道都被忽略了，但是感觉自己对于比原内部的运作似乎又多了一些。</p>\n<p>也许现在积累的知识差不多了，该向比原的核心进发了。在下一篇，我将会尝试理解和分析比原的核心，在学习的过程中，可能会采用跟目前探索流程分解问题不同的方式。另外，可能前期会花不少时间，所以下一篇出来得会晚一些。当然，如果失败了，说明我目前积累的知识还是不够，我还需要再回到当前的做法，想办法再从不同的地方多剥一些比原的外壳，然后再尝试。</p>\n<hr>\n<p>如果你觉得这些文章对你非常有用，控制不住想打赏作者，可以有以下选择：</p>\n<ol>\n<li>BTM: <code class=\"gatsby-code-text\">0x6bcCfb7265d4aB0C1a71F7d19b9E581cae73D777</code></li>\n<li>BTC: <code class=\"gatsby-code-text\">1Af2Q23Y1kqgtgbryzjS7RxrnEmyvYuX4b</code></li>\n<li>ETH: <code class=\"gatsby-code-text\">0x6bcCfb7265d4aB0C1a71F7d19b9E581cae73D777</code></li>\n</ol>\n<p>多少请随意，心意最重要，我们一起努力吧！</p>","frontmatter":{"title":"显示交易的详细信息","next":null,"prev":null},"fields":{"path":null,"slug":"docs/bytomanalysis-transfer-detail.html"}}},"pathContext":{"slug":"docs/bytomanalysis-transfer-detail.html"}}